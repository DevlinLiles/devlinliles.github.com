---
layout: post
title: Separating POCO and Context in EF 4.0
date: 2010-08-16
---
<p>I found that I like the streamlined process of working with Entity Framework. The auto generation of domain class is nice when dealing with Existing databases. I dislike having to put domain classes in Infrastructure or putting data base context in Core.</p>
<p>Using the POCO Entities T4 templates you can separate these.</p>
<p>Download <a href="http://visualstudiogallery.msdn.microsoft.com/en-us/23df0450-5677-4926-96cc-173d02752313">here</a></p>
<p>Add a new Entity Data Model and Generate from the data base.</p>
<p><a href="/images/image_24.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" src="/images/image_thumb_24.png" border="0" alt="image" width="449" height="312" /></a></p>
<p>Then right click the background of the model and add a generated code item.</p>
<p><a href="/images/image_25.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" src="/images/image_thumb_25.png" border="0" alt="image" width="457" height="238" /></a></p>
<p>Select the POCO Objects</p>
<p><a href="/images/image_26.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" src="/images/image_thumb_26.png" border="0" alt="image" width="444" height="308" /></a>&nbsp;</p>
<p>This will create Two .tt files. One is the POCO Classes and one is the Context. We are going to use the onion architecture for this example. We want to move the context to infrastructure so that our model and POCO classes and model are in core.</p>
<p><a href="/images/image_27.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" src="/images/image_thumb_27.png" border="0" alt="image" width="244" height="231" /></a></p>
<p>and</p>
<p><a href="/images/image_28.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" src="/images/image_thumb_28.png" border="0" alt="image" width="211" height="40" /></a></p>
<p>To separate the context from the Domain we will need to edit the context template. You do not want to edit the classes generated because this will just get wiped out.</p>
<p><a href="/images/image_29.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" src="/images/image_thumb_29.png" border="0" alt="image" width="532" height="257" /></a></p>
<p><a href="/images/image_30.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" src="/images/image_thumb_30.png" border="0" alt="image" width="535" height="400" /></a></p>
<p>The edit we have to make is to simply add the namespace of the Domain objects to the using statements, and the path of the EDMX file to the input. I am still hunting a way to keep from hard coding a absolute path to the EDMX but until then this will have to work.</p>
<p>&nbsp;</p>
<p>Enjoy.</p>
